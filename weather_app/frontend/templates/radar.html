{% extends 'template/main.html' %} 
{% load static %} 
{% block header %}
    <link rel="stylesheet" href="{% static '//css//landing.css' %}">
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap" async defer></script>
{% endblock %}
{% block content %}
    <style>
        #map {
            position: absolute;
            top: 0;
            z-index: -10;
            bottom: 0;
            width: calc(100vw - 50px);
            right: 0;
            height: 100vh;
        }
    </style>
    <div id="map"></div>
    <script>
        var mapStyle = [
            {
                "featureType": "all",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "saturation": 36
                    },
                    {
                        "color": "#000000"
                    },
                    {
                        "lightness": 40
                    }
                ]
            },
            {
                "featureType": "all",
                "elementType": "labels.text.stroke",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#000000"
                    },
                    {
                        "lightness": 16
                    }
                ]
            },
            {
                "featureType": "all",
                "elementType": "labels.icon",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "landscape",
                "elementType": "geometry",
                "stylers": [
                    {
                        "color": "#090909"
                    },
                    {
                        "lightness": 20
                    }
                ]
            },
            {
                "featureType": "poi",
                "elementType": "geometry",
                "stylers": [
                    {
                        "color": "#000000"
                    },
                    {
                        "lightness": 21
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "geometry.fill",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#110f0f"
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "geometry.stroke",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "labels",
                "stylers": [
                    {
                        "visibility": "simplified"
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "color": "#c3c3c3"
                    }
                ]
            },
            {
                "featureType": "transit",
                "elementType": "geometry",
                "stylers": [
                    {
                        "color": "#000000"
                    },
                    {
                        "lightness": 19
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "geometry",
                "stylers": [
                    {
                        "color": "#000000"
                    },
                    {
                        "lightness": "-77"
                    }
                ]
            }
        ];

        const API_KEY = "{{ tomorrowio_api_key }}";

        // pick the field (like temperature, precipitationIntensity or cloudCover)
        const DATA_FIELD = 'precipitationIntensity';

        // set the ISO timestamp (now for all fields, up to 6 hour out for precipitationIntensity)
        const TIMESTAMP = (new Date()).toISOString(); 
        

        // initialize the map
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 7,
                center: {
                    lat: -27.4698,
                    lng: 153.0251
                },
                styles: mapStyle,
                disableDefaultUI: true,
            
        });

        // inject the tile layer
        var imageMapType = new google.maps.ImageMapType({
            getTileUrl: function(coord, zoom) {
                if (zoom > 12) {
                    return null;
                }

                return `https://api.tomorrow.io/v4/map/tile/${zoom}/${coord.x}/${coord.y}/${DATA_FIELD}/${TIMESTAMP}.png?apikey=${API_KEY}`;
            },
            tileSize: new google.maps.Size(256, 256)
            });

            map.overlayMapTypes.push(imageMapType);
        }

    </script>
    {% include 'chatbot/chat.html' %}
{% endblock %}