{% extends 'template/auth.html' %}
{% load static %} 

{% block header %}
  <link rel="stylesheet" href="{% static '//css//auth.css' %}">
{% endblock %}

{% block content %}
  <div class="container p-0 m-0" id="page">
      <div class="weather-radar">
        <div id="map"></div>
        <div class="right"></div>
      </div>
      <div class="auth-form">
        <div class="logos mt-2">
          <div class="logo">
            <a href="/"><h1>Rain<span class="text-secondary">Check</span></h1></a>
          </div>
          <div class="ms-2"><div class="divider"></div></div>
          <div class="atc ms-2">
            <a href="/atc/"><img src="{% static '//images//logos//atc//atc-crest-white.svg' %}" alt="ATC"></a>
          </div>
        </div>
        <div class="form">
          <form action="" method="POST">
            <h1 class="text-center mb-1">REGISTER</h1>
            {% csrf_token %}
            {% if error %}
              <div class="error-div">
                <p class="text-center">{{ error }}</p>
              </div>
            {% endif %}
            <input type="text" class="mb-1" id="first_name" name="first_name" placeholder="First Name" required>
            <input type="text" class="mb-1" id="last_name" name="last_name" placeholder="Last Name" required>
            <input type="text" class="mb-1" id="email" name="email" placeholder="Email" required>
            <input type="password" class="mb-1" id="password1" name="password1" placeholder="Password" required>
            <input type="password" class="mb-3" id="password2" name="password2" placeholder="Confirm Password" required>
            <div class="mb-3 buttons">
              <button type="submit" class="btn btn-primary">Register</button>
              <a type="submit" onclick="window.history.back()" class="btn go_back">Go Back</a>
            </div>
            <div class="mb-3">
              <p class="text-center">Already have an account? <a href="/login/" class="text-secondary">Login</a></p>
            </div>
        </div>
      </div>
  </div>
  <script>
      mapboxgl.accessToken = "{{ mapbox_access_token }}";

      const API_KEY = "{{ tomorrowio_api_key }}";

      // pick the field (like temperature, precipitationIntensity or cloudCover)
      const DATA_FIELD = 'precipitationIntensity';

      // set the ISO timestamp (now for all fields, up to 6 hour out for precipitationIntensity)
      const TIMESTAMP = (new Date()).toISOString();

      var latitude = 153.02207;
      var longitude = -27.46917;
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
              latitude = position.coords.latitude;
              longitude = position.coords.longitude;
          });
      }

      // initialize the map
      var map = (window.map = new mapboxgl.Map({
        container: 'map',
        zoom: 7,
        center: [latitude, longitude],
        style: 'mapbox://styles/nathan-perrier23/clqthibtm00ci01pp38f03g3w',
        antialias: true
      }));

      // inject the tile layer
      map.on('load', function() {
        map.addSource('tomorrow-io-api', {
            "type": 'raster',
            "tiles": [`https://api.tomorrow.io/v4/map/tile/{z}/{x}/{y}/${DATA_FIELD}/${TIMESTAMP}.png?apikey=${API_KEY}`],
            "tileSize": 256,
            "attribution": '&copy; <a href="http://127.0.0.1:8000/atc/">Powered by Ambrose Treacy College</a>'
        });
        map.addLayer({
            "id": "radar-tiles",
            "type": "raster",
            "source": "tomorrow-io-api",
            "minzoom": 1,
            "maxzoom": 12
        });
      });
  </script>
{% endblock %}
